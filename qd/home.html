<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>亦知亦行 谈判清单</title>
    <link rel="stylesheet" href="../assets/node_modules/normalize.css/normalize.css">
    <link rel="stylesheet" href="../assets/node_modules/animate.css/animate.css">
    <link rel="stylesheet" href="../assets/css/qdv1.0.main.css">
    <link rel="ICON" href="../assets/img/main/icon.png">
</head>
<body>
<div class="qd-content" id="qd_home_page">
    <!-- home page -->
    <div class="qd-section">
        <div class="qd-home-box">
            <div class="qd-home-box__top">
                <div class="qd-logo__1">
                    <img src="../assets/img/qd/logo/qd-logo-3.png" alt="">
                </div>
                <div class="qd-home-top__btnBox">
                    <a href="new/index.html?p=1" class="qd-new-btn"></a>
                    <a href="javascript:;" class="qd-example-btn"></a>
                </div>
            </div>
            <div class="qd-home-box__content">
                <div class="qd-home-catalog-box">
                    <div class="qd-home-catalog" v-for="data in datas">
                        <div class="qd-home-catalog-title-box">
                            <a v-bind:href="'new/menu.html?qdId=' + data._id" class="qd-home-catalog__title">{{data.title}}</a>
                            <span class="qd-home-catalog__date">2019-01-01</span>
                        </div>
                        <div class="qd-home-catalog-content-box">
                            <p class="qd-home-catalog__both"><span>己方：</span>{{data.both2}}</p>
                            <p class="qd-home-catalog__both"><span>对方：</span>{{data.both1}}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="qd-home-box__foot">
                <nav class="qd-navigation-box">
                    <ul class="qd-pagination-box">
                        <li class="qd-nav-previous-box">
                            <a href="javaScript:;"> < </a>
                        </li>
                        <li class="qd-nav-btn-box">
                            <a href="javaScript:;" class="qd-nav-btn">1</a>
                        </li>
                        <li class="qd-nav-next-box">
                            <a href="javaScript:;"> > </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
<script type="text/javascript">
    'user strict';

    var mainVue = new Vue({
        el: '#qd_home_page',
        data: {
            datas: [],
            userId:''
        },
        methods: {},
        mounted: function () {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.indexOf('micromessenger') !== -1) {
                function GetRequest() {
                    var url = decodeURI(location.search);
                    var theRequest = new Object();
                    if (url.indexOf("?") != -1) {
                        var str = url.substr(1);
                        strs = str.split("&");
                        for (var i = 0; i < strs.length; i++) {
                            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                        }
                    }
                    return theRequest;
                }

                var urlData = GetRequest();
                if (urlData.openid === undefined || urlData.openid === '') {
                    axios({
                        method: 'get',
                        url: 'http://www.cogitoactio.com/api/v1/wechat/auth_start?num=3',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    }).then(function (response) {
                        window.location.href = response.data.url
                    }).catch(function (error) {
                        console.log(error);
                    });
                } else {
                    var jsonStr = {
                        userId: '',
                    };
                    jsonStr.userId = urlData.openid;
                    this.userId = urlData.openid;
                    localStorage.setItem("userId", jsonStr.userId);
                    axios.post("http://www.cogitoactio.com/api/v1/negotiation/getNegotiationList", jsonStr).then(function (res) {
                        console.log(res.data.data);
                        mainVue.datas = res.data.data
                    }).catch(function (error) {
                        console.log(error);
                    })
                }
            } else {
                alert('请使用微信自带浏览器打开');
            }
        }
    });
</script>
</body>
</html>